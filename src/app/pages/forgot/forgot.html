<div class="theme-control">
    <button id="theme-switcher" (click)="toggleTheme()" type="button">
        <svg width="22" height="22" viewBox="0 0 24 24">
            <path class="sun" d="M12 6a6 6 0 1 1 0 12 6 6 0 0 1 0-12zm0-2a8 8 0 1 0 0 16 8 8 0 0 0 0-16"/>
            <path class="sun-ray" d="M12 2v2m0 16v2M4 12H2m20 0h-2m3-7l-2 2m-13 13l-2 2m17-15l2 2M3 19l2 2"/>
        </svg>
    </button>
</div>

<div>
    <button id="back-button" (click)="goBack()" aria-label="Volver">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" class="back-circle"/>
            <path d="M14 8L10 12L14 16" class="back-arrow" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </button>
</div>

<div class="main">
    <div class="left-panel">
        <div class="brand-section">
            <div class="logo">
                <svg class="brand-mark" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                    <path d="M60 20 L100 40 V80 L60 100 L20 80 V40 Z" class="vault-shape"/>
                    <circle cx="60" cy="60" r="18" class="security-core"/>
                    <path d="M60 42 L60 78 M48 60 L72 60" class="access-cross"/>
                </svg>
                <h1>AR<span>Cash</span></h1>
                <h4>VIRTUAL WALLET</h4>
            </div>
            
            <div class="recovery-features">
                <div class="feature">
                    <div class="feature-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3" stroke="currentColor" stroke-width="2"/>
                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="feature-text">
                        <h3>Recuperación Rápida</h3>
                        <p>Acceso inmediato a través de email verificado</p>
                    </div>
                </div>
                
                <div class="feature">
                    <div class="feature-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="16" r="1" fill="currentColor"/>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="feature-text">
                        <h3>Máxima Seguridad</h3>
                        <p>Encriptación de extremo a extremo en todos los procesos</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="right-panel">
        <div class="recovery-content">
            <!-- Recovery Icon -->
            <div class="recovery-icon">
                <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="60" cy="60" r="45" class="shield-outer"/>
                    <circle cx="60" cy="60" r="30" class="shield-inner"/>
                    <path d="M45 60 L55 70 L75 50" class="check-mark"/>
                    <path d="M30 40 Q60 20 90 40 Q90 60 60 80 Q30 60 30 40" class="shield-shape"/>
                </svg>
            </div>

            <div class="recovery-header">
                <h1>Recuperar Cuenta</h1>
                <p class="recovery-subtitle">Te enviaremos un enlace de recuperación a tu email</p>
            </div>

            <form #recoverForm (ngSubmit)="onSubmit()" class="recovery-form" autocomplete="off" *ngIf="!emailSent">
                <div class="input-container">
                    <label for="email">Correo electrónico</label>
                    <div class="input-wrapper">
                        <input
                            type="email" 
                            id="email" 
                            name="email" 
                            [(ngModel)]="email"
                            required 
                            placeholder="ejemplo@correo.com"
                            class="effect-1"
                            [class.error]="emailError">
                        <span class="focus-border"></span>
                        <div class="input-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2"/>
                                <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                    </div>
                    <div>
                        @if (emailError) {
                            <div class="error-message">
                                {{ emailError }}
                            </div>
                        }
                    </div>
                </div>

                <button type="submit" [disabled]="isLoading || !email" class="recovery-btn">
                    @if (!isLoading) {
                        <span class="btn-content">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            Enviar instrucciones
                        </span>
                    }
                    @if (isLoading) {
                        <span class="btn-loading">
                            <div class="spinner"></div>
                            Enviando...
                        </span>
                    }
                </button>
            </form>

            <!-- Sección de confirmación y reenvío -->
            <div class="email-sent-section" *ngIf="emailSent">
                <div class="success-message">
                    <div class="success-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h3>¡Correo enviado!</h3>
                    <p>Hemos enviado las instrucciones de recuperación a <strong>{{ censurarCorreo(email) }}</strong></p>
                    <p class="check-spam">Si no ves el correo en tu bandeja de entrada, revisa la carpeta de spam.</p>
                </div>

                <!-- Sección de reenvío que aparece después de 10 segundos -->
                <div class="resend-section" *ngIf="showResendSection">
                    <div class="resend-prompt">
                        <h4>¿Todavía no recibiste tu correo?</h4>
                        <p>Solicita uno nuevo</p>
                    </div>
                    
                    <button 
                        class="resend-btn"
                        [disabled]="isResending || resendCooldown > 0"
                        (click)="resendRecoveryEmail()">
                        @if (!isResending && resendCooldown === 0) {
                            <span class="btn-content">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M1 4v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                Reenviar correo
                            </span>
                        }
                        @if (isResending) {
                            <span class="btn-loading">
                                <div class="spinner"></div>
                                Reenviando...
                            </span>
                        }
                        @if (resendCooldown > 0) {
                            <span class="btn-cooldown">
                                Reenviar en {{ resendCooldown }}s
                            </span>
                        }
                    </button>

                    <button class="secondary-btn" (click)="sendToAnotherEmail()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Reenviar correo
                    </button>
                </div>
            </div>

            <div class="recovery-info">
                <div class="info-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>El enlace expira en 24 horas</span>
                </div>
                <div class="info-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="16" r="1" fill="currentColor"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Proceso completamente seguro</span>
                </div>
            </div>
        </div>
    </div>

    <div class="global-footer">
        <p>ArCash™ | Virtual Wallet</p>
        <a href="https://mail.google.com/mail/?view=cm&fs=1&to=helparcash2025@gmail.com" target="_blank" class="email-link">helparcash2025@gmail.com</a>
    </div>
</div>

<div class="theme-control">
    <button id="theme-switcher" (click)="toggleTheme()" type="button">
        <svg width="22" height="22" viewBox="0 0 24 24">
            <path class="sun" d="M12 6a6 6 0 1 1 0 12 6 6 0 0 1 0-12zm0-2a8 8 0 1 0 0 16 8 8 0 0 0 0-16"/>
            <path class="sun-ray" d="M12 2v2m0 16v2M4 12H2m20 0h-2m3-7l-2 2m-13 13l-2 2m17-15l2 2M3 19l2 2"/>
        </svg>
    </button>
</div>
<div>
    <button id="back-button" aria-label="Volver" (click)="goBack()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" class="back-circle"/>
            <path d="M14 8L10 12L14 16" class="back-arrow" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </button>
</div>

<div class="main">
    <div class="left-panel">
        <div class="logo">
            <svg class="brand-mark" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                <path d="M60 20 L100 40 V80 L60 100 L20 80 V40 Z" class="vault-shape"/>
                <circle cx="60" cy="60" r="18" class="security-core"/>
                <path d="M60 42 L60 78 M48 60 L72 60" class="access-cross"/>
            </svg>
            <h1>AR<span>Cash</span></h1>
            <h4>VIRTUAL WALLET</h4>
        </div>
    </div>

    <div class="right-panel">
        <div class="formulario">
            <h2>Registrarse</h2>

            <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate>

                <div class="input-container">
                    <label>Nombre</label>
                    <div class="input-wrapper">
                        <input class="effect-1" 
                               type="text" 
                               formControlName="nombre" 
                               placeholder="Ingrese su nombre"
                               maxlength="50">
                        <span class="focus-border"></span>
                    </div>
                    <div *ngIf="registerForm.get('nombre')?.invalid && registerForm.get('nombre')?.touched" class="error-container">
                        <small class="error-message" *ngIf="registerForm.get('nombre')?.hasError('required')">El nombre es requerido.</small>
                        <small class="error-message" *ngIf="registerForm.get('nombre')?.hasError('pattern')">El nombre solo puede contener letras y espacios.</small>
                        <small class="error-message" *ngIf="registerForm.get('nombre')?.hasError('minlength')">El nombre debe tener al menos 2 caracteres.</small>
                        <small class="error-message" *ngIf="registerForm.get('nombre')?.hasError('maxlength')">El nombre no puede tener más de 50 caracteres.</small>
                    </div>
                </div>

                <div class="input-container">
                    <label>Apellido</label>
                    <div class="input-wrapper">
                        <input class="effect-1" 
                               type="text" 
                               formControlName="apellido" 
                               placeholder="Ingrese su apellido"
                               maxlength="50">
                        <span class="focus-border"></span>
                    </div>
                    <div *ngIf="registerForm.get('apellido')?.invalid && registerForm.get('apellido')?.touched" class="error-container">
                        <small class="error-message" *ngIf="registerForm.get('apellido')?.hasError('required')">El apellido es requerido.</small>
                        <small class="error-message" *ngIf="registerForm.get('apellido')?.hasError('pattern')">El apellido solo puede contener letras y espacios.</small>
                        <small class="error-message" *ngIf="registerForm.get('apellido')?.hasError('minlength')">El apellido debe tener al menos 2 caracteres.</small>
                        <small class="error-message" *ngIf="registerForm.get('apellido')?.hasError('maxlength')">El apellido no puede tener más de 50 caracteres.</small>
                    </div>
                </div>

                <div class="input-container">
                    <label>D.N.I</label>
                    <div class="input-wrapper">
                        <input class="effect-1" 
                               type="text" 
                               formControlName="dni" 
                               maxlength="8" 
                               placeholder="12345678"
                               (input)="onDniInput($event)">
                        <span class="focus-border"></span>
                    </div>
                    <div *ngIf="registerForm.get('dni')?.invalid && registerForm.get('dni')?.touched" class="error-container">
                        <small class="error-message" *ngIf="registerForm.get('dni')?.hasError('required')">El DNI es requerido.</small>
                        <small class="error-message" *ngIf="registerForm.get('dni')?.hasError('pattern')">Debe ser un DNI de 8 dígitos sin puntos.</small>
                        <small class="error-message" *ngIf="registerForm.get('dni')?.hasError('minlength')">El DNI debe tener exactamente 8 dígitos.</small>
                        <small class="error-message" *ngIf="registerForm.get('dni')?.hasError('maxlength')">El DNI debe tener exactamente 8 dígitos.</small>
                    </div>
                </div>

                <div class="input-container">
                    <label>Email</label>
                    <div class="input-wrapper">
                        <input class="effect-1" 
                               type="email" 
                               formControlName="email" 
                               placeholder="ejemplo@correo.com"
                               maxlength="100">
                        <span class="focus-border"></span>
                    </div>
                    <div *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched" class="error-container">
                        <small class="error-message" *ngIf="registerForm.get('email')?.hasError('required')">El email es requerido.</small>
                        <small class="error-message" *ngIf="registerForm.get('email')?.hasError('email')">Ingrese un formato de email válido.</small>
                        <small class="error-message" *ngIf="registerForm.get('email')?.hasError('pattern')">El formato del email no es válido.</small>
                    </div>
                </div>

                <div formGroupName="passwords" class="password-group">
                    <div class="input-container">
                        <label>Contraseña</label>
                        <div class="input-wrapper password-wrapper">
                            <input class="effect-1" 
                                   [type]="showPassword ? 'text' : 'password'" 
                                   formControlName="password"
                                   placeholder="Mínimo 8 caracteres">
                            <button type="button" class="password-toggle" (click)="togglePasswordVisibility()" [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <path *ngIf="!showPassword" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle *ngIf="!showPassword" cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                    <path *ngIf="showPassword" d="m1 1 22 22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path *ngIf="showPassword" d="M6.71 6.71C4.03 8.75 2 12 2 12s3 6 10 6c1.35 0 2.6-.3 3.71-.9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path *ngIf="showPassword" d="M14 14.12c-.55.19-1.14.29-1.76.29-2.48 0-4.5-2.02-4.5-4.5 0-.62.1-1.21.29-1.76" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path *ngIf="showPassword" d="M12 7c2.76 0 5 2.24 5 5 0 .28-.02.56-.07.83" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                            <span class="focus-border"></span>
                        </div>
                        <div *ngIf="registerForm.get('passwords.password')?.invalid && registerForm.get('passwords.password')?.touched" class="error-container">
                            <small class="error-message" *ngIf="registerForm.get('passwords.password')?.hasError('required')">La contraseña es requerida.</small>
                            <small class="error-message" *ngIf="registerForm.get('passwords.password')?.hasError('minlength')">Debe tener al menos 8 caracteres.</small>
                            <small class="error-message" *ngIf="registerForm.get('passwords.password')?.hasError('pattern')">Debe contener al menos: 1 mayúscula, 1 minúscula, 1 número y 1 carácter especial.</small>
                        </div>
                    </div>

                    <div class="input-container">
                        <label>Confirmar Contraseña</label>
                        <div class="input-wrapper password-wrapper">
                            <input class="effect-1" 
                                   [type]="showConfirmPassword ? 'text' : 'password'" 
                                   formControlName="confirmPassword"
                                   placeholder="Repita su contraseña">
                            <button type="button" class="password-toggle" (click)="toggleConfirmPasswordVisibility()" [attr.aria-label]="showConfirmPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <path *ngIf="!showConfirmPassword" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle *ngIf="!showConfirmPassword" cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                    <path *ngIf="showConfirmPassword" d="m1 1 22 22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path *ngIf="showConfirmPassword" d="M6.71 6.71C4.03 8.75 2 12 2 12s3 6 10 6c1.35 0 2.6-.3 3.71-.9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path *ngIf="showConfirmPassword" d="M14 14.12c-.55.19-1.14.29-1.76.29-2.48 0-4.5-2.02-4.5-4.5 0-.62.1-1.21.29-1.76" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path *ngIf="showConfirmPassword" d="M12 7c2.76 0 5 2.24 5 5 0 .28-.02.56-.07.83" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                            <span class="focus-border"></span>
                        </div>
                        <div *ngIf="registerForm.get('passwords')?.hasError('passwordMismatch') && registerForm.get('passwords.confirmPassword')?.touched" class="error-container">
                            <small class="error-message">Las contraseñas no coinciden.</small>
                        </div>
                    </div>
                </div>

                <div class="input-container" >
                    <label>Nombre de usuario</label>
                    <div class="input-wrapper">
                        <input class="effect-1"  
                               type="text" 
                               formControlName="alias"
                               placeholder="usuario123"
                               maxlength="10">
                        <span class="focus-border"></span>
                    </div>
                    <div *ngIf="registerForm.get('alias')?.invalid && registerForm.get('alias')?.touched" class="error-container">
                        <small class="error-message" *ngIf="registerForm.get('alias')?.hasError('required')">El alias es requerido.</small>
                        <small class="error-message" *ngIf="registerForm.get('alias')?.hasError('minlength')">El alias debe tener al menos 3 caracteres.</small>
                        <small class="error-message" *ngIf="registerForm.get('alias')?.hasError('maxlength')">El alias no puede tener más de 10 caracteres.</small>
                        <small class="error-message" *ngIf="registerForm.get('alias')?.hasError('pattern')">Solo se permiten letras, números, guiones y guiones bajos.</small>
                    </div>
                </div>

                <button type="submit" [disabled]="registerForm.invalid">Enviar</button>

            </form>
        </div>
    </div>

    <div class="global-footer">
        <p>ArCash™ | Virtual Wallet</p>
        <a href="https://mail.google.com/mail/?view=cm&fs=1&to=helparcash2025@gmail.com" target="_blank" class="email-link">helparcash2025@gmail.com</a>
    </div>
</div>
<!-- Loading Screen de validación de token -->
<div *ngIf="isValidatingToken" id="validation-loader-overlay">
    <div class="validation-loader-container">
        <div class="loading-logo-container">
            <svg class="brand-mark" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                <path d="M60 20 L100 40 V80 L60 100 L20 80 V40 Z" class="vault-shape"/>
                <circle cx="60" cy="60" r="18" class="security-core"/>
                <path d="M60 42 L60 78 M48 60 L72 60" class="access-cross"/>
            </svg>
            <div class="spinner-circle"></div>
        </div>
        <div class="loading-brand">
            <h1>AR<span>Cash</span></h1>
            <p class="brand-tagline">The best virtual wallet</p>
            <p class="loading-text">Validando enlace de recuperación...</p>
        </div>
    </div>
</div>

<!-- Controles de navegación -->
<div class="theme-control">
    <button id="theme-switcher" (click)="toggleTheme()" type="button">
        <svg width="22" height="22" viewBox="0 0 24 24">
            <path class="sun" d="M12 6a6 6 0 1 1 0 12 6 6 0 0 1 0-12zm0-2a8 8 0 1 0 0 16 8 8 0 0 0 0-16"/>
            <path class="sun-ray" d="M12 2v2m0 16v2M4 12H2m20 0h-2m3-7l-2 2m-13 13l-2 2m17-15l2 2M3 19l2 2"/>
        </svg>
    </button>
</div>

<div>
    <button id="back-button" aria-label="Volver" (click)="goBack()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" class="back-circle"/>
            <path d="M14 8L10 12L14 16" class="back-arrow" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </button>
</div>

<!-- Contenido principal -->
<div class="main" *ngIf="!isValidatingToken">
    <div class="left-panel">
        <div class="logo">
            <svg class="brand-mark" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                <path d="M60 20 L100 40 V80 L60 100 L20 80 V40 Z" class="vault-shape"/>
                <circle cx="60" cy="60" r="18" class="security-core"/>
                <path d="M60 42 L60 78 M48 60 L72 60" class="access-cross"/>
            </svg>
            <h1>AR<span>Cash</span></h1>
            <h4>VIRTUAL WALLET</h4>
        </div>
    </div>

    <div class="right-panel">
        <div class="formulario">
            <h2>Restablecer contraseña</h2>

            <!-- Formulario - mostrar solo cuando el token esté validado -->
            <div *ngIf="token" class="form-container">
                <div *ngIf="error" class="error">{{ error }}</div>

                <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" novalidate>
                    <div formGroupName="passwords">

                        <div class="input-container">
                            <label>Nueva contraseña</label>
                            <div class="input-wrapper">
                                <input
                                    class="effect-1"
                                    type="password"
                                    formControlName="password"
                                    autocomplete="new-password"
                                    [class.invalid]="resetForm.get('passwords.password')?.invalid && resetForm.get('passwords.password')?.touched" />
                                <span class="focus-border"></span>
                            </div>
                            <div>
                                @if (resetForm.get('passwords.password')?.invalid && resetForm.get('passwords.password')?.touched) {
                                    <div class="error-container">
                                        @if (resetForm.get('passwords.password')?.hasError('required')) {
                                            <small class="error-message">La contraseña es obligatoria.</small>
                                        }
                                        @if (resetForm.get('passwords.password')?.hasError('minLength')) {
                                            <small class="error-message">Debe tener al menos 8 caracteres.</small>
                                        }
                                        @if (resetForm.get('passwords.password')?.hasError('lowercase')) {
                                            <small class="error-message">Debe contener al menos una letra minúscula.</small>
                                        }
                                        @if (resetForm.get('passwords.password')?.hasError('uppercase')) {
                                            <small class="error-message">Debe contener al menos una letra mayúscula.</small>
                                        }
                                        @if (resetForm.get('passwords.password')?.hasError('number')) {
                                            <small class="error-message">Debe contener al menos un número.</small>
                                        }
                                        @if (resetForm.get('passwords.password')?.hasError('specialChar')) {
                                            <small class="error-message">Debe contener al menos un carácter especial (!@#$%^&*...).</small>
                                        }
                                    </div>
                                }
                            </div>
                        </div>

                        <div class="input-container">
                            <label>Confirmar contraseña</label>
                            <div class="input-wrapper">
                                <input
                                    class="effect-1"
                                    type="password"
                                    formControlName="confirmPassword"
                                    autocomplete="new-password"
                                    [class.invalid]="resetForm.get('passwords.confirmPassword')?.invalid && resetForm.get('passwords.confirmPassword')?.touched" />
                                <span class="focus-border"></span>
                            </div>
                            <div>
                                @if (resetForm.get('passwords.confirmPassword')?.invalid && resetForm.get('passwords.confirmPassword')?.touched) {
                                    <div class="error-container">
                                        @if (resetForm.get('passwords.confirmPassword')?.hasError('required')) {
                                            <small class="error-message">Debe confirmar la contraseña.</small>
                                        }
                                    </div>
                                }
                                @if (resetForm.get('passwords')?.hasError('passwordMismatch') && resetForm.get('passwords.confirmPassword')?.touched) {
                                    <div class="error-container">
                                        <small class="error-message">Las contraseñas no coinciden.</small>
                                    </div>
                                }
                            </div>
                        </div>

                    </div>

                    <button
                        type="submit"
                        [disabled]="!canSubmit()">
                        <span *ngIf="!isLoading">Cambiar contraseña</span>
                        <span *ngIf="isLoading" class="loading-text">
                            <svg class="spinner" width="16" height="16" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"/>
                                <path d="M12 2A10 10 0 0 1 22 12" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                            Procesando...
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="global-footer">
        <p>ArCash™ | Virtual Wallet</p>
        <a href="https://mail.google.com/mail/?view=cm&fs=1&to=helparcash2025@gmail.com" target="_blank" class="email-link">helparcash2025@gmail.com</a>
    </div>
</div>

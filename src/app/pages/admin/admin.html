<!-- Controles de tema y navegación -->
<div class="theme-control">
  <button id="theme-switcher" (click)="toogleTheme()" type="button">
    <svg width="22" height="22" viewBox="0 0 24 24">
      <path class="sun" d="M12 6a6 6 0 1 1 0 12 6 6 0 0 1 0-12zm0-2a8 8 0 1 0 0 16 8 8 0 0 0 0-16"/>
      <path class="sun-ray" d="M12 2v2m0 16v2M4 12H2m20 0h-2m3-7l-2 2m-13 13l-2 2m17-15l2 2M3 19l2 2"/>
    </svg>
  </button>
</div>

<div>
  <button id="back-button" aria-label="Volver" (click)="goBack()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="10" class="back-circle"/>
      <path d="M14 8L10 12L14 16" class="back-arrow" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</div>

<!-- Contenido principal -->
<div class="main">
  <div class="left-panel">
    <div class="logo">
      <svg class="brand-mark" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <path d="M60 20 L100 40 V80 L60 100 L20 80 V40 Z" class="vault-shape"/>
        <circle cx="60" cy="60" r="18" class="security-core"/>
        <path d="M60 42 L60 78 M48 60 L72 60" class="access-cross"/>
      </svg>
      <h1>AR<span>Cash</span></h1>
      <h4>VIRTUAL WALLET</h4>
    </div>
  </div>

  <div class="right-panel">
    <div class="formulario">
      <h2>Panel de Administración</h2>
      
      <!-- Vista principal con botones -->
      <div *ngIf="!showAdminForm && !showUsersList">
        <button 
          (click)="loadUsers()" 
          class="access-btn primary"
          [disabled]="loading">
          {{ loading ? 'Cargando...' : 'Ver usuarios autenticados' }}
        </button>
        
        <button 
          (click)="showCreateAdminForm()" 
          class="access-btn secondary">
          Crear nuevo administrador
        </button>
      </div>

      <!-- Lista de usuarios -->
      <div *ngIf="showUsersList" style="margin-top:20px;">
        <ul *ngIf="users.length > 0; else noUsers" class="usuarios-lista">
          <li *ngFor="let user of users" class="usuario-item">
            <div class="usuario-datos" (click)="showUserDetails(user)">
              <strong>{{ user.name }} {{ user.lastName }}</strong>
              <span class="usuario-dni">DNI: {{ user.dni }}</span>
              <span class="usuario-email">{{ user.email }}</span>
              <span class="usuario-username">@{{ user.username }}</span>
            </div>
            
            <button 
              *ngIf="user.active; else enableButton"
              class="inhabilitar-btn"
              (click)="toggleUserStatus(user.id, true)">
              Inhabilitar
            </button>
            
            <ng-template #enableButton>
              <button 
                class="habilitar-btn"
                (click)="toggleUserStatus(user.id, false)">
                Habilitar
              </button>
            </ng-template>
          </li>
        </ul>
        
        <ng-template #noUsers>
          <p>No hay usuarios autenticados.</p>
        </ng-template>
      </div>

      <!-- Formulario de creación de admin -->
      <div *ngIf="showAdminForm">
        <h2>Crear Nuevo Administrador</h2>
        
        <form [formGroup]="adminForm" (ngSubmit)="createAdmin()" novalidate>
          
          <!-- Nombre -->
          <div class="input-container">
            <label>Nombre</label>
            <div class="input-wrapper">
              <input 
                class="effect-1" 
                type="text" 
                formControlName="name"
                placeholder="Ingrese el nombre"
                maxlength="50">
              <span class="focus-border"></span>
            </div>
            <div>
              @if (adminForm.get('name')?.invalid && adminForm.get('name')?.touched) {
                <div class="error-container">
                  @if (adminForm.get('name')?.hasError('required')) {
                    <small class="error-message">El nombre es requerido.</small>
                  }
                  @if (adminForm.get('name')?.hasError('pattern')) {
                    <small class="error-message">El nombre solo puede contener letras y espacios.</small>
                  }
                  @if (adminForm.get('name')?.hasError('maxlength')) {
                    <small class="error-message">El nombre no puede tener más de 50 caracteres.</small>
                  }
                </div>
              }
            </div>
          </div>

          <!-- Apellido -->
          <div class="input-container">
            <label>Apellido</label>
            <div class="input-wrapper">
              <input 
                class="effect-1" 
                type="text" 
                formControlName="lastName"
                placeholder="Ingrese el apellido"
                maxlength="50">
              <span class="focus-border"></span>
            </div>
            <div>
              @if (adminForm.get('lastName')?.invalid && adminForm.get('lastName')?.touched) {
                <div class="error-container">
                  @if (adminForm.get('lastName')?.hasError('required')) {
                    <small class="error-message">El apellido es requerido.</small>
                  }
                  @if (adminForm.get('lastName')?.hasError('pattern')) {
                    <small class="error-message">El apellido solo puede contener letras y espacios.</small>
                  }
                  @if (adminForm.get('lastName')?.hasError('maxlength')) {
                    <small class="error-message">El apellido no puede tener más de 50 caracteres.</small>
                  }
                </div>
              }
            </div>
          </div>

          <!-- DNI -->
          <div class="input-container">
            <label>D.N.I</label>
            <div class="input-wrapper">
              <input 
                class="effect-1" 
                type="text" 
                formControlName="dni"
                placeholder="Ingrese el DNI"
                maxlength="8">
              <span class="focus-border"></span>
            </div>
            <div>
              @if (adminForm.get('dni')?.invalid && adminForm.get('dni')?.touched) {
                <div class="error-container">
                  @if (adminForm.get('dni')?.hasError('required')) {
                    <small class="error-message">El DNI es requerido.</small>
                  }
                  @if (adminForm.get('dni')?.hasError('pattern')) {
                    <small class="error-message">El DNI debe contener exactamente 8 dígitos.</small>
                  }
                </div>
              }
            </div>
          </div>

          <!-- Email -->
          <div class="input-container">
            <label>Email</label>
            <div class="input-wrapper">
              <input 
                class="effect-1" 
                type="email" 
                formControlName="email"
                placeholder="Ingrese el email"
                maxlength="50">
              <span class="focus-border"></span>
            </div>
            <div>
              @if (adminForm.get('email')?.invalid && adminForm.get('email')?.touched) {
                <div class="error-container">
                  @if (adminForm.get('email')?.hasError('required')) {
                    <small class="error-message">El email es requerido.</small>
                  }
                  @if (adminForm.get('email')?.hasError('email')) {
                    <small class="error-message">Ingrese un email válido.</small>
                  }
                  @if (adminForm.get('email')?.hasError('maxlength')) {
                    <small class="error-message">El email no puede tener más de 50 caracteres.</small>
                  }
                </div>
              }
            </div>
          </div>

          <!-- Nombre de usuario -->
          <div class="input-container">
            <label>Nombre de usuario</label>
            <div class="input-wrapper">
              <input 
                class="effect-1" 
                type="text" 
                formControlName="username"
                placeholder="Ingrese el nombre de usuario"
                maxlength="10">
              <span class="focus-border"></span>
            </div>
            <div>
              @if (adminForm.get('username')?.invalid && adminForm.get('username')?.touched) {
                <div class="error-container">
                  @if (adminForm.get('username')?.hasError('required')) {
                    <small class="error-message">El nombre de usuario es requerido.</small>
                  }
                  @if (adminForm.get('username')?.hasError('maxlength')) {
                    <small class="error-message">El nombre de usuario no puede tener más de 10 caracteres.</small>
                  }
                </div>
              }
            </div>
          </div>

          <!-- Contraseña -->
          <div class="input-container">
            <label>Contraseña</label>
            <div class="input-wrapper">
              <input 
                class="effect-1" 
                type="password" 
                formControlName="password"
                placeholder="Ingrese la contraseña">
              <span class="focus-border"></span>
            </div>
            <div>
              @if (adminForm.get('password')?.invalid && adminForm.get('password')?.touched) {
                <div class="error-container">
                  @if (adminForm.get('password')?.hasError('required')) {
                    <small class="error-message">La contraseña es requerida.</small>
                  }
                  @if (adminForm.get('password')?.hasError('minlength')) {
                    <small class="error-message">La contraseña debe tener al menos 6 caracteres.</small>
                  }
                </div>
              }
            </div>
          </div>

          <!-- Confirmar Contraseña -->
          <div class="input-container">
            <label>Confirmar Contraseña</label>
            <div class="input-wrapper">
              <input 
                class="effect-1" 
                type="password" 
                formControlName="confirmPassword"
                placeholder="Confirme la contraseña">
              <span class="focus-border"></span>
            </div>
            <div>
              @if (passwordMismatch) {
                <div class="error-container">
                  <small class="error-message">Las contraseñas no coinciden.</small>
                </div>
              }
            </div>
          </div>

          <!-- Mensaje de respuesta -->
          <div *ngIf="formMessage" class="response-message" [style.color]="formMessageColor">
            {{ formMessage }}
          </div>

          <!-- Botones de acción -->
          <button 
            type="submit" 
            class="access-btn primary"
            [disabled]="adminForm.invalid || passwordMismatch">
            Crear Administrador
          </button>
          
          <button 
            type="button" 
            (click)="cancelAdminForm()" 
            class="access-btn secondary">
            Cancelar
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal de información de usuario -->
<div 
  *ngIf="showModal" 
  class="modal show"
  (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <span class="close-modal" (click)="closeModal()">&times;</span>
    <h3>Información del Usuario</h3>
    <div *ngIf="selectedUser" class="info-user">
      <p><strong>Nombre:</strong> {{ selectedUser.name }}</p>
      <p><strong>Apellido:</strong> {{ selectedUser.lastName }}</p>
      <p><strong>DNI:</strong> {{ selectedUser.dni }}</p>
      <p><strong>Email:</strong> {{ selectedUser.email }}</p>
      <p><strong>Username:</strong> {{ selectedUser.username }}</p>
      <p><strong>ID Cuenta:</strong> {{ selectedUser.idAccount || '-' }}</p>
      <p><strong>Activo:</strong> 
        <span [class]="selectedUser.active ? 'estado-si' : 'estado-no'">
          {{ selectedUser.active ? 'Sí' : 'No' }}
        </span>
      </p>
      <p><strong>Habilitado:</strong> 
        <span [class]="selectedUser.enabled ? 'estado-si' : 'estado-no'">
          {{ selectedUser.enabled ? 'Sí' : 'No' }}
        </span>
      </p>
    </div>
  </div>
</div>


